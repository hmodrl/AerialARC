<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complete Payment - AERIALARC</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables */
    :root {
      --primary-color: #0ac5a7;
      --primary-dark: #078a6b;
      --secondary-color: #2fb3ff;
      --secondary-dark: #0066cc;
      --accent-color: #ffd166;
      --accent-dark: #ffb703;
      --bg-dark: #05060a;
      --bg-card: rgba(8, 14, 22, 0.95);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.9);
      --text-muted: rgba(255, 255, 255, 0.7);
      --border-color: rgba(10, 197, 167, 0.22);
      --border-success: rgba(47, 179, 255, 0.2);
      --shadow-primary: 0 10px 30px rgba(10, 197, 167, 0.12);
      --shadow-success: 0 10px 30px rgba(47, 179, 255, 0.12);
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Container */
    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    .payment-header {
      text-align: center;
      padding: 60px 0 40px;
      background: linear-gradient(135deg, rgba(255, 59, 141, 0.1) 0%, transparent 100%);
      border-bottom: 1px solid var(--border-color);
    }

    .payment-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 15px;
    }

    .payment-subtitle {
      font-size: 1.1rem;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      padding: 30px 0;
      margin-bottom: 20px;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      position: relative;
    }

    .step-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.1rem;
      transition: var(--transition);
    }

    .step.active .step-number {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .step.completed .step-number {
      background: var(--secondary-color);
      border-color: var(--secondary-color);
      color: #000;
    }

    .step-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .step.active .step-label {
      color: var(--primary-color);
      font-weight: 600;
    }

    .step.completed .step-label {
      color: var(--secondary-color);
      font-weight: 600;
    }

    .step-line {
      height: 2px;
      width: 100px;
      background: rgba(255, 255, 255, 0.1);
      position: relative;
      top: -25px;
    }

    /* Payment Form */
    .payment-form-container {
      padding: 40px 0 80px;
    }

    .payment-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 40px;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-primary);
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* WhatsApp Input */
    .whatsapp-section {
      margin-bottom: 40px;
    }

    .whatsapp-input-group {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .country-code-select {
      flex: 0 0 200px;
      position: relative;
    }

    .country-code-select select {
      width: 100%;
      padding: 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 1rem;
      cursor: pointer;
      appearance: none;
      transition: var(--transition);
      padding-right: 40px;
    }

    .country-code-select::after {
      content: 'â–¾';
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-color);
      pointer-events: none;
      font-size: 1.2rem;
    }

    .country-code-select select:focus {
      outline: none;
      border-color: var(--primary-color);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(255, 59, 141, 0.1);
    }

    .country-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 5px;
    }

    .country-flag {
      width: 20px;
      height: 15px;
      border-radius: 2px;
      object-fit: cover;
    }

    .country-code-text {
      font-weight: 500;
      color: var(--text-primary);
    }

    .country-name {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .phone-input {
      flex: 1;
      position: relative;
    }

    .phone-input input {
      width: 100%;
      padding: 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 1rem;
      transition: var(--transition);
    }

    .phone-input input:focus {
      outline: none;
      border-color: var(--primary-color);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(255, 59, 141, 0.1);
    }

    .form-help {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .form-help i {
      color: var(--primary-color);
    }

    /* Payment Method Selection */
    .payment-method-section {
      margin-bottom: 40px;
    }

    .payment-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .payment-method {
      position: relative;
    }

    .payment-method input[type="radio"] {
      display: none;
    }

    .payment-method-label {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      height: 100%;
    }

    .payment-method-label:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }

    .payment-method input[type="radio"]:checked + .payment-method-label {
      border-color: var(--primary-color);
      background: rgba(255, 59, 141, 0.1);
      box-shadow: 0 5px 15px rgba(255, 59, 141, 0.2);
    }

    .payment-icon-container {
      width: 60px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .payment-icon {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .payment-icon.paypal {
      background: #003087;
      padding: 5px;
      border-radius: 4px;
    }

    .payment-icon.benefit {
      background: white;
      padding: 3px;
      border-radius: 4px;
    }

    .payment-info {
      flex: 1;
    }

    .payment-name {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 5px;
    }

    .payment-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .payment-fee {
      font-size: 0.9rem;
      color: var(--secondary-color);
      font-weight: 600;
    }

    /* Card Details (for Credit Card option) */
    .card-details-section {
      margin-top: 25px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }

    .card-details-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .card-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .card-input-group {
      display: flex;
      gap: 15px;
    }

    .card-input-group .form-group {
      flex: 1;
    }

    .card-number-input {
      position: relative;
    }

    /* Playstation Card Details */
    .psn-card-section {
      margin-top: 25px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }

    .psn-card-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    /* Benefit Pay Details */
    .benefit-pay-section {
      margin-top: 25px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }

    .benefit-pay-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .benefit-qr {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: var(--radius-md);
      max-width: 250px;
      margin-left: auto;
      margin-right: auto;
    }

    .benefit-qr-placeholder {
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, #0066cc 0%, #0099ff 100%);
      border-radius: var(--radius-sm);
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9rem;
    }

    /* Order Summary */
    .order-summary {
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-md);
      padding: 25px;
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
    }

    .summary-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-label {
      color: var(--text-secondary);
    }

    .summary-value {
      font-weight: 600;
      color: var(--text-primary);
    }

    .summary-total {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--secondary-color);
    }

    /* Terms and Conditions */
    .terms-section {
      margin-bottom: 40px;
    }

    .terms-box {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      padding: 20px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .terms-box p {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .terms-checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }

    .terms-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .terms-checkbox label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      cursor: pointer;
    }

    /* Pay Button */
    .pay-section {
      text-align: center;
      padding: 30px 0;
    }

    .pay-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 20px 60px;
      font-size: 1.2rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: var(--radius-md);
      border: none;
      cursor: pointer;
      transition: var(--transition);
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-primary);
      position: relative;
      overflow: hidden;
      min-width: 250px;
    }

    .pay-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .pay-btn:hover::before {
      width: 400px;
      height: 400px;
    }

    .pay-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(255, 59, 141, 0.3);
    }

    .pay-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .pay-btn.success {
      background: linear-gradient(135deg, var(--secondary-color) 0%, var(--secondary-dark) 100%);
      box-shadow: var(--shadow-success);
    }

    /* Success Message */
    .success-message {
      text-align: center;
      padding: 40px;
      background: rgba(0, 255, 136, 0.05);
      border: 2px solid var(--border-success);
      border-radius: var(--radius-lg);
      margin-top: 30px;
      animation: fadeIn 0.5s ease;
      display: none;
    }

    .success-message.active {
      display: block;
    }

    .success-icon {
      font-size: 4rem;
      color: var(--secondary-color);
      margin-bottom: 20px;
      animation: scaleIn 0.5s ease;
    }

    .success-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 15px;
    }

    .success-text {
      color: var(--text-secondary);
      margin-bottom: 25px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .whatsapp-success {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--border-success);
      border-radius: var(--radius-md);
      color: var(--secondary-color);
      font-weight: 600;
      margin-top: 15px;
    }

    .back-home-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 15px 30px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      text-decoration: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.2);
      margin-top: 20px;
    }

    .back-home-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }
      
      .payment-header {
        padding: 40px 0 30px;
      }
      
      .payment-header h1 {
        font-size: 2rem;
      }
      
      .progress-steps {
        gap: 10px;
      }
      
      .step-line {
        width: 60px;
      }
      
      .payment-card {
        padding: 30px 20px;
      }
      
      .whatsapp-input-group {
        flex-direction: column;
      }
      
      .country-code-select {
        flex: 0 0 auto;
        width: 100%;
      }
      
      .payment-methods {
        grid-template-columns: 1fr;
      }
      
      .card-form-grid {
        grid-template-columns: 1fr;
      }
      
      .card-input-group {
        flex-direction: column;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes scaleIn {
      from { 
        opacity: 0;
        transform: scale(0.5);
      }
      to { 
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Loading State */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Form Group */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .form-control {
      width: 100%;
      padding: 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(255, 59, 141, 0.1);
    }

    /* Important Notice */
    .important-notice {
      background: rgba(255, 59, 141, 0.1);
      border: 1px solid var(--primary-color);
      border-radius: var(--radius-md);
      padding: 20px;
      position: relative;
      overflow: hidden;
      margin-top: 20px;
    }

    .important-notice::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--primary-color);
    }

    .notice-title {
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notice-title i {
      font-size: 1.1rem;
    }

    /* Country flags as data URLs */
    .flag-bh { background: #ce1126; border-right: solid 15px white; }
    .flag-sa { background: #006c35; }
    .flag-ae { background: #ff0000; border-bottom: solid 10px #000000; border-top: solid 10px #009900; }
    .flag-us { background: #b22234; border-bottom: solid 7px white; }
    .flag-gb { background: #012169; border-bottom: solid 5px white; border-top: solid 5px #c8102e; }
    .flag-qa { background: #8d1b3d; border-right: solid 20px white; }
    .flag-om { background: #db1616; border-bottom: solid 10px #db1616; border-top: solid 10px #008000; }
    .flag-kw { background: #007a3d; border-right: solid 30px #ce1126; }
    .flag-jo { background: #007a3d; border-top: solid 10px black; border-bottom: solid 10px white; }
    .flag-eg { background: #ce1126; border-bottom: solid 10px white; border-top: solid 10px black; }
  </style>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is my payment secure?",
        "acceptedAnswer": {"@type": "Answer", "text": "We use Stripe Checkout and never store raw card details."}
      },
      {
        "@type": "Question",
        "name": "How can I check my order status?",
        "acceptedAnswer": {"@type": "Answer", "text": "Check /order/:sessionId or return to this page after payment; we verify with Stripe webhooks."}
      }
    ]
  }
  </script>
</head>
<body>
  <!-- Header -->
  <div class="payment-header">
    <div class="container">
      <h1>Complete Your Payment</h1>
      <p class="payment-subtitle">Enter your WhatsApp number and choose payment method to complete your Rocket League boosting order</p>
      
      <div class="progress-steps">
        <div class="step completed">
          <div class="step-number">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-label">Order Details</div>
        </div>
        <div class="step-line"></div>
        <div class="step active">
          <div class="step-number">2</div>
          <div class="step-label">Payment</div>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-label">Complete</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Form -->
  <div class="payment-form-container">
    <div class="container">
      <div class="payment-card">
        <!-- WhatsApp Number -->
        <div class="section-title">
          <i class="fab fa-whatsapp"></i>
          WhatsApp Contact
        </div>
        
        <div class="whatsapp-section">
          <p>We'll contact you on WhatsApp for order updates and communication</p>
          
          <div class="whatsapp-input-group">
            <div class="country-code-select">
              <select id="countryCode">
                <option value="973" data-flag="bh">ðŸ‡§ðŸ‡­ Bahrain (+973)</option>
                <option value="966" data-flag="sa">ðŸ‡¸ðŸ‡¦ Saudi Arabia (+966)</option>
                <option value="971" data-flag="ae">ðŸ‡¦ðŸ‡ª UAE (+971)</option>
                <option value="1" data-flag="us">ðŸ‡ºðŸ‡¸ USA (+1)</option>
                <option value="44" data-flag="gb">ðŸ‡¬ðŸ‡§ UK (+44)</option>
                <option value="974" data-flag="qa">ðŸ‡¶ðŸ‡¦ Qatar (+974)</option>
                <option value="968" data-flag="om">ðŸ‡´ðŸ‡² Oman (+968)</option>
                <option value="965" data-flag="kw">ðŸ‡°ðŸ‡¼ Kuwait (+965)</option>
                <option value="962" data-flag="jo">ðŸ‡¯ðŸ‡´ Jordan (+962)</option>
                <option value="20" data-flag="eg">ðŸ‡ªðŸ‡¬ Egypt (+20)</option>
              </select>
            </div>
            
            <div class="phone-input">
              <input type="tel" id="phoneNumber" placeholder="Enter your phone number" required>
              <div class="form-help">
                <i class="fas fa-info-circle"></i>
                Enter your phone number without the leading zero
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Method -->
        <div class="section-title">
          <i class="fas fa-credit-card"></i>
          Payment Method
        </div>
        
        <div class="payment-method-section">
          <p>Select your preferred payment method</p>
          
          <div class="payment-methods">
            <!-- Credit/Debit Card -->
            <div class="payment-method">
              <input type="radio" id="creditCard" name="paymentMethod" value="creditCard">
              <label class="payment-method-label" for="creditCard">
                <div class="payment-icon-container">
                  <i class="fas fa-credit-card" style="font-size: 1.8rem; color: white;"></i>
                </div>
                <div class="payment-info">
                  <div class="payment-name">Credit/Debit Card</div>
                  <div class="payment-desc">Visa, Mastercard, American Express</div>
                </div>
                <div class="payment-fee">no fees</div>
              </label>
            </div>
            
            <!-- PayPal -->
            <div class="payment-method">
              <input type="radio" id="paypal" name="paymentMethod" value="paypal">
              <label class="payment-method-label" for="paypal">
                <div class="payment-icon-container">
                  <i class="fab fa-paypal" style="font-size: 1.8rem; color: white;"></i>
                </div>
                <div class="payment-info">
                  <div class="payment-name">PayPal</div>
                  <div class="payment-desc">Pay with PayPal account or card</div>
                </div>
                <div class="payment-fee">no fees</div>
              </label>
            </div>
            
            <!-- Playstation Gift Card -->
            <div class="payment-method">
              <input type="radio" id="playstationCard" name="paymentMethod" value="playstationCard">
              <label class="payment-method-label" for="playstationCard">
                <div class="payment-icon-container">
                  <i class="fab fa-playstation" style="font-size: 1.8rem; color: white;"></i>
                </div>
                <div class="payment-info">
                  <div class="payment-name">PlayStation Gift Card</div>
                  <div class="payment-desc">US/UK/MEA Region Cards Accepted</div>
                </div>
                <div class="payment-fee">no fees</div>
              </label>
            </div>
            
            <!-- Benefit Pay (only for Bahrain) -->
            <div class="payment-method">
              <input type="radio" id="benefitPay" name="paymentMethod" value="benefitPay">
              <label class="payment-method-label" for="benefitPay">
                <div class="payment-icon-container">
                  <i class="fas fa-mobile-alt" style="font-size: 1.8rem; color: white;"></i>
                </div>
                <div class="payment-info">
                  <div class="payment-name">Benefit Pay</div>
                  <div class="payment-desc">Bahrain Mobile Payment</div>
                </div>
                <div class="payment-fee">no fees</div>
              </label>
            </div>
          </div>
        </div>

        <!-- Card Details Section -->
        <div class="card-details-section" id="cardDetailsSection">
          <div class="section-title" style="font-size: 1.2rem; margin-bottom: 15px;">
            <i class="fas fa-lock"></i>
            Card Details (handled by Stripe Checkout)
          </div>
          
          <p>You'll be redirected to Stripe's secure hosted checkout page where you can safely enter your card details. We do not collect or store raw card data on this site.</p>
        </div>

        <!-- PayPal Section -->
        <div class="benefit-pay-section" id="paypalSection">
          <div class="section-title" style="font-size: 1.2rem; margin-bottom: 15px;">
            <i class="fab fa-paypal"></i>
            PayPal Payment
          </div>
          
          <p>You will be redirected to PayPal to complete your payment securely.</p>
          
          <div class="important-notice">
            <div class="notice-title">
              <i class="fas fa-info-circle"></i>
              Important Information
            </div>
            <p>After clicking "Pay Now", you'll be redirected to PayPal's secure payment page. Complete the payment there, then return to this page.</p>
          </div>
        </div>

        <!-- Playstation Card Section -->
        <div class="psn-card-section" id="psnCardSection">
          <div class="section-title" style="font-size: 1.2rem; margin-bottom: 15px;">
            <i class="fab fa-playstation"></i>
            Playstation Card Details
          </div>
          
          <div class="form-group">
            <label for="psnCardCode">Gift Card Code</label>
            <input type="text" id="psnCardCode" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX">
            <div class="form-help">
              <i class="fas fa-info-circle"></i>
              Enter the 16-digit code from your PlayStation Store gift card
            </div>
          </div>
          
          <div class="form-group">
            <label for="psnCardRegion">Card Region</label>
            <select id="psnCardRegion" class="form-control">
              <option value="us">United States (USD)</option>
              <option value="uk">United Kingdom (GBP)</option>
              <option value="uae">UAE (AED)</option>
              <option value="saudi">Saudi Arabia (SAR)</option>
              <option value="bahrain">Bahrain (BHD)</option>
            </select>
          </div>
          
          <div class="important-notice">
            <div class="notice-title">
              <i class="fas fa-exclamation-triangle"></i>
              IMPORTANT
            </div>
            <p>PlayStation gift card payments are accepted with no additional fees.</p>
          </div>
        </div>

        <!-- Benefit Pay Section -->
        <div class="benefit-pay-section" id="benefitPaySection">
          <div class="section-title" style="font-size: 1.2rem; margin-bottom: 15px;">
            <i class="fas fa-qrcode"></i>
            Benefit Pay Instructions
          </div>
          
          <p>Please follow these steps to complete your payment:</p>
          
          <ol style="margin: 15px 0 15px 20px; color: var(--text-secondary);">
            <li style="margin-bottom: 10px;">Open Benefit Pay app on your phone</li>
            <li style="margin-bottom: 10px;">Scan the QR code below or enter our mobile number: <strong>+973 3420 3541</strong></li>
            <li style="margin-bottom: 10px;">Send the exact amount shown below</li>
            <li>Use your order ID as the payment reference</li>
          </ol>
          
          <div class="benefit-qr">
            <div class="benefit-qr-placeholder">
              <i class="fas fa-qrcode" style="font-size: 3rem; color: white;"></i>
            </div>
            <p style="color: #666; font-size: 0.9rem;">Scan with Benefit Pay app</p>
          </div>
          
          <div class="important-notice">
            <div class="notice-title">
              <i class="fas fa-clock"></i>
              Payment Verification
            </div>
            <p>Your payment will be verified within 1 hour. We'll notify you on WhatsApp once confirmed.</p>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <div class="summary-title">
            <i class="fas fa-receipt"></i>
            Order Summary
          </div>
          
          <div class="summary-row">
            <span class="summary-label">Item</span>
            <span class="summary-value" id="orderItem">Rocket League Boosting</span>
          </div>

          <div class="summary-row">
            <span class="summary-label">Service</span>
            <span class="summary-value" id="orderService">Platinum III â†’ Diamond I</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label">Platform</span>
            <span class="summary-value" id="orderPlatform">-</span>
          </div>

          <div class="summary-row">
            <span class="summary-label">Base Price</span>
            <span class="summary-value" id="orderBasePrice">$70.00</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label">GC Reward</span>
            <span class="summary-value" id="orderGcReward">-</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label">SSL Reward</span>
            <span class="summary-value" id="orderSslReward">-</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label">Platform Fee</span>
            <span class="summary-value" id="orderPlatformFee">$5.00</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label">Payment Method Fee</span>
            <span class="summary-value" id="orderPaymentFee">$0.00</span>
          </div>
          
          <div class="summary-row">
            <span class="summary-label summary-total">Total Amount</span>
            <span class="summary-value summary-total" id="orderTotal">$75.00</span>
          </div>
        </div>

        <!-- Terms and Conditions -->
        <div class="terms-section">
          <div class="section-title" style="font-size: 1.2rem;">
            <i class="fas fa-file-contract"></i>
            Terms & Conditions
          </div>
          
          <div class="terms-box">
            <p>By completing this payment, you agree to the following terms:</p>
            <p>1. All boosting services are performed by professional players during off-peak hours.</p>
            <p>2. Average completion time is 1-3 days depending on rank difference.</p>
            <p>3. We are not responsible for any account penalties imposed by Psyonix/Epic Games.</p>
            <p>4. Refunds are only available if service cannot be completed within 7 days.</p>
            <p>5. You must disable 2-Factor Authentication before service begins.</p>
            <p>6. We maintain strict confidentiality and delete credentials after completion.</p>
            <p>7. Payment processing may take up to 1 hour to verify.</p>
          </div>
          
          <div class="terms-checkbox">
            <input type="checkbox" id="agreeTerms">
            <label for="agreeTerms">I have read and agree to the terms and conditions</label>
          </div>
        </div>

        <!-- Pay Button -->
        <div class="pay-section">
          <button class="pay-btn" id="payButton" disabled>
            <i class="fas fa-lock"></i>
            Pay Now
          </button>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="success-title">Payment Completed Successfully!</div>
          <div class="success-text">
            Your payment has been processed and your order is now confirmed. We'll contact you on WhatsApp shortly to begin the boosting process.
          </div>
          
          <div class="whatsapp-success">
            <i class="fab fa-whatsapp"></i>
            WhatsApp: <span id="successWhatsapp">+973 XXXXXXXX</span>
          </div>
          
          <div style="margin-top: 30px;">
            <a href="index.html" class="back-home-btn">
              <i class="fas fa-home"></i>
              Back to Home
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      setupEventListeners();
      loadOrderSummary();
      updatePaymentFee();
      validateForm();
      enhanceCountrySelect();
      checkCheckoutResult();
    });

    // Handle return from Stripe Checkout
    async function checkCheckoutResult() {
      const params = new URLSearchParams(window.location.search);
      const sessionId = params.get('session_id');

      if (params.get('success') === '1' && sessionId) {
        // Poll server for the final order state
        setProcessingState(true, 'Verifying payment...');
        try {
          const order = await pollOrderStatus(sessionId, 12, 2000); // 12 attempts, 2s interval (~24s)
          if (order && order.status === 'paid') {
            // Show success
            const countryCode = document.getElementById('countryCode').value;
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            document.getElementById('successMessage').classList.add('active');
            document.getElementById('successWhatsapp').textContent = phoneNumber ? `+${countryCode} ${phoneNumber}` : 'Not provided';
            document.querySelectorAll('.step')[2].classList.add('completed');
            document.getElementById('payButton').classList.add('success');
            document.getElementById('payButton').innerHTML = '<i class="fas fa-check"></i> Payment Completed!';
          } else if (order && order.status === 'pending') {
            alert('Payment is being processed. We didn\'t receive a final confirmation yet. We will notify you via WhatsApp when the payment is confirmed.');
          } else {
            alert('Could not confirm payment status. Please contact support with your session id: ' + sessionId);
          }
        } catch (err) {
          console.error('Error checking order status', err);
          alert('Error verifying payment. Please contact support with session id: ' + sessionId);
        } finally {
          setProcessingState(false);
        }
      } else if (params.get('canceled') === '1') {
        alert('Payment was canceled. You can try again or choose another payment method.');
      }
    }

    function setProcessingState(isProcessing, text) {
      const payBtn = document.getElementById('payButton');
      if (isProcessing) {
        payBtn.disabled = true;
        payBtn.innerHTML = text ? text : 'Processing...';
      } else {
        payBtn.disabled = false;
      }
    }

    // Poll the server for order state by session id
    async function pollOrderStatus(sessionId, attempts = 6, intervalMs = 2000) {
      let last = null;
      for (let i = 0; i < attempts; i++) {
        try {
          const res = await fetch(`${serverBase}/order/${encodeURIComponent(sessionId)}`);
          if (res.ok) {
            const data = await res.json();
            if (data && data.order) {
              last = data.order;
              if (last.status === 'paid') return last;
            }
          }
        } catch (err) {
          console.warn('Order check failed', err);
        }
        await new Promise(r => setTimeout(r, intervalMs));
      }
      return last;
    }

    // Enhance country select with custom styling
    function enhanceCountrySelect() {
      const select = document.getElementById('countryCode');
      const options = select.querySelectorAll('option');
      
      // Create custom flags
      options.forEach(option => {
        const flagClass = option.getAttribute('data-flag');
        if (flagClass) {
          const flagSpan = document.createElement('span');
          flagSpan.className = `flag-${flagClass}`;
          flagSpan.style.cssText = 'width: 20px; height: 15px; display: inline-block; margin-right: 8px; border-radius: 2px;';
          option.innerHTML = flagSpan.outerHTML + option.textContent;
        }
      });
    }

    // Setup event listeners
    function setupEventListeners() {
      // WhatsApp input
      document.getElementById('countryCode').addEventListener('change', validateForm);
      document.getElementById('phoneNumber').addEventListener('input', validateForm);
      
      // Payment method selection
      document.querySelectorAll('input[name="paymentMethod"]').forEach(input => {
        input.addEventListener('change', () => {
          updatePaymentMethodSections();
          updatePaymentFee();
          validateForm();
        });
      });
      
      // Card details validation (only if present â€” we use Stripe hosted checkout for cards)
      const cardNumberEl = document.getElementById('cardNumber');
      if (cardNumberEl) cardNumberEl.addEventListener('input', formatCardNumber);
      const expiryEl = document.getElementById('expiryDate');
      if (expiryEl) expiryEl.addEventListener('input', formatExpiryDate);
      const cvvEl = document.getElementById('cvv');
      if (cvvEl) cvvEl.addEventListener('input', validateCVV);
      
      // Form inputs validation
      const cardNameEl = document.getElementById('cardName');
      if (cardNameEl) cardNameEl.addEventListener('input', validateForm);
      document.getElementById('psnCardCode').addEventListener('input', validateForm);
      document.getElementById('psnCardRegion').addEventListener('change', validateForm);
      
      // Terms checkbox
      document.getElementById('agreeTerms').addEventListener('change', validateForm);
      
      // Pay button
      document.getElementById('payButton').addEventListener('click', processPayment);
    }

    // Load order summary from previous page (reads URL params if present)
    function loadOrderSummary() {
      const params = new URLSearchParams(window.location.search);
      const itemParam = params.get('account') || params.get('service');
      const serviceParam = params.get('service') || params.get('account') || 'Platinum III â†’ Diamond I';
      const platformParam = params.get('platform') || '-';
      const basePriceParam = params.get('basePrice') || params.get('price');
      const basePrice = basePriceParam ? parseFloat(basePriceParam) : 70.00;
      const platformFee = 5.00; // default
      const paymentFee = 0.00; // default
      const gcReward = false;
      const sslReward = false;
      const total = basePrice + platformFee + paymentFee;

      // Set values in DOM
      document.getElementById('orderItem').textContent = itemParam || 'Rocket League Boosting';
      document.getElementById('orderService').textContent = serviceParam;
      document.getElementById('orderPlatform').textContent = platformParam;
      document.getElementById('orderBasePrice').textContent = `$${basePrice.toFixed(2)}`;
      document.getElementById('orderGcReward').textContent = gcReward ? '$15.00' : '-';
      document.getElementById('orderSslReward').textContent = sslReward ? '$25.00' : '-';
      document.getElementById('orderPlatformFee').textContent = `$${platformFee.toFixed(2)}`;
      document.getElementById('orderPaymentFee').textContent = `$${paymentFee.toFixed(2)}`;
      document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
    }

    // Update payment method sections visibility
    function updatePaymentMethodSections() {
      const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
      
      // Hide all sections first
      document.getElementById('cardDetailsSection').classList.remove('active');
      document.getElementById('paypalSection').classList.remove('active');
      document.getElementById('psnCardSection').classList.remove('active');
      document.getElementById('benefitPaySection').classList.remove('active');
      
      // Show selected section
      if (selectedMethod) {
        if (selectedMethod.value === 'creditCard') {
          document.getElementById('cardDetailsSection').classList.add('active');
        } else if (selectedMethod.value === 'paypal') {
          document.getElementById('paypalSection').classList.add('active');
        } else if (selectedMethod.value === 'playstationCard') {
          document.getElementById('psnCardSection').classList.add('active');
        } else if (selectedMethod.value === 'benefitPay') {
          document.getElementById('benefitPaySection').classList.add('active');
        }
      }
    }

    // Update payment fee based on selected method
    function updatePaymentFee() {
      // All payment methods have no fees now
      const paymentFee = 0;
      
      // Update display
      document.getElementById('orderPaymentFee').textContent = `$${paymentFee.toFixed(2)}`;
      
      // Update total using currently displayed base price
      const basePriceText = document.getElementById('orderBasePrice').textContent || '$0';
      const basePrice = parseFloat(basePriceText.replace(/[^0-9.]/g, '')) || 0;
      const platformFee = 5.00;
      const total = basePrice + platformFee + paymentFee;
      document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
    }

    // Format card number with spaces
    function formatCardNumber() {
      let cardNumber = document.getElementById('cardNumber').value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
      let formatted = '';
      
      for (let i = 0; i < cardNumber.length; i++) {
        if (i > 0 && i % 4 === 0) {
          formatted += ' ';
        }
        formatted += cardNumber[i];
      }
      
      document.getElementById('cardNumber').value = formatted.substring(0, 19);
      validateForm();
    }

    // Format expiry date
    function formatExpiryDate() {
      let expiry = document.getElementById('expiryDate').value.replace(/[^0-9]/g, '');
      
      if (expiry.length >= 2) {
        expiry = expiry.substring(0, 2) + '/' + expiry.substring(2, 4);
      }
      
      document.getElementById('expiryDate').value = expiry.substring(0, 5);
      validateForm();
    }

    // Validate CVV
    function validateCVV() {
      let cvv = document.getElementById('cvv').value.replace(/[^0-9]/g, '');
      document.getElementById('cvv').value = cvv.substring(0, 4);
      validateForm();
    }

    // Validate form
    function validateForm() {
      const payBtn = document.getElementById('payButton');
      const countryCode = document.getElementById('countryCode').value;
      const phoneNumber = document.getElementById('phoneNumber').value.trim();
      const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
      const agreeTerms = document.getElementById('agreeTerms').checked;
      
      // Validate WhatsApp number
      const isPhoneValid = phoneNumber.length >= 8 && /^\d+$/.test(phoneNumber);
      
      // Validate payment method details
      let isPaymentValid = false;
      
      if (paymentMethod) {
        if (paymentMethod.value === 'creditCard') {
          // Using Stripe Checkout - card fields are collected on Stripe's hosted page, so accept as valid here
          isPaymentValid = true;
        } else if (paymentMethod.value === 'paypal') {
          // PayPal always valid - redirects to PayPal
          isPaymentValid = true;
        } else if (paymentMethod.value === 'playstationCard') {
          const psnCode = document.getElementById('psnCardCode').value.trim();
          isPaymentValid = psnCode.length >= 16;
        } else if (paymentMethod.value === 'benefitPay') {
          // Bahrain number validation for Benefit Pay
          if (countryCode === '973') {
            isPaymentValid = isPhoneValid;
          } else {
            alert('Benefit Pay is only available for Bahrain numbers (+973)');
            document.getElementById('benefitPay').checked = false;
            updatePaymentMethodSections();
            return validateForm();
          }
        }
      }
      
      // Enable/disable pay button
      if (isPhoneValid && paymentMethod && isPaymentValid && agreeTerms) {
        payBtn.disabled = false;
      } else {
        payBtn.disabled = true;
      }
      
      // Update progress steps
      updateProgressSteps(isPhoneValid, paymentMethod);
    }

    // Update progress steps
    function updateProgressSteps(phoneValid, paymentMethod) {
      const steps = document.querySelectorAll('.step');
      
      if (phoneValid) {
        steps[1].classList.add('completed');
      } else {
        steps[1].classList.remove('completed');
        steps[2].classList.remove('completed');
      }
      
      if (phoneValid && paymentMethod) {
        steps[1].classList.add('completed');
      }
    }

    // Load Stripe publishable key and initialize Stripe.js
    let serverBase = (window.location.protocol === 'file:') ? 'http://localhost:3000' : window.location.origin;
    let stripeClient = null;

    async function loadStripeConfig() {
      try {
        const res = await fetch(`${serverBase}/config`);
        const cfg = await res.json();
        if (cfg && cfg.publishableKey) {
          // Dynamically load Stripe.js
          await new Promise((resolve, reject) => {
            const s = document.createElement('script');
            s.src = 'https://js.stripe.com/v3/';
            s.onload = resolve;
            s.onerror = reject;
            document.head.appendChild(s);
          });
          stripeClient = Stripe(cfg.publishableKey);
        }
      } catch (err) {
        console.warn('Could not load Stripe config', err);
      }
    }

    // Create checkout session on the server
    async function createCheckoutSession(payload) {
      try {
        const res = await fetch(`${serverBase}/create-checkout-session`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        return await res.json();
      } catch (err) {
        return { error: err.message };
      }
    }

    // Process payment
    async function processPayment() {
      const payBtn = document.getElementById('payButton');
      const countryCode = document.getElementById('countryCode').value;
      const phoneNumber = document.getElementById('phoneNumber').value.trim();
      const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
      const totalAmount = document.getElementById('orderTotal').textContent;

      // Show loading state
      const originalContent = payBtn.innerHTML;
      payBtn.innerHTML = '<div class="loading-spinner"></div> Processing...';
      payBtn.disabled = true;

      // If user selected Credit/Debit Card but Stripe is not set up, show a helpful error
      if (paymentMethod && paymentMethod.value === 'creditCard' && !stripeClient) {
        alert('Card payments are currently not available. Please choose another payment method or contact support.');
        payBtn.innerHTML = originalContent;
        payBtn.disabled = false;
        return;
      }

      // If Stripe is initialized and user selected Credit/Debit Card, use Stripe Checkout
      if (stripeClient && paymentMethod && paymentMethod.value === 'creditCard') {
        // Gather order details
        const payload = {
          item: document.getElementById('orderItem').textContent || 'AERIALARC Purchase',
          service: document.getElementById('orderService').textContent || '',
          platform: document.getElementById('orderPlatform').textContent || '',
          basePrice: parseFloat((document.getElementById('orderBasePrice').textContent || '$0').replace(/[^0-9.]/g, '')) || 0
        };

        const result = await createCheckoutSession(payload);
        if (result && result.id) {
          // Redirect to Stripe Checkout
          const { error } = await stripeClient.redirectToCheckout({ sessionId: result.id });
          if (error) {
            alert('Stripe redirect failed: ' + error.message);
            payBtn.innerHTML = originalContent;
            payBtn.disabled = false;
          }
          return; // stop local simulation - Stripe handles the rest
        } else {
          alert('Could not create checkout session: ' + (result.error || 'unknown error'));
          payBtn.innerHTML = originalContent;
          payBtn.disabled = false;
          return;
        }
      }

      // Non-Stripe or fallback payment flow (simulate)
      setTimeout(() => {
        // Show success state
        payBtn.innerHTML = '<i class="fas fa-check"></i> Payment Completed!';
        payBtn.classList.add('success');

        // Show success message
        document.getElementById('successMessage').classList.add('active');

        // Update WhatsApp number in success message
        document.getElementById('successWhatsapp').textContent = `+${countryCode} ${phoneNumber}`;

        // Update progress steps
        document.querySelectorAll('.step')[2].classList.add('completed');

        // Log payment details (in real app, this would be sent to server)
        const paymentDetails = {
          whatsapp: `+${countryCode}${phoneNumber}`,
          paymentMethod: paymentMethod ? paymentMethod.value : 'unknown',
          amount: totalAmount,
          timestamp: new Date().toISOString(),
          orderId: 'RLB-' + Math.random().toString(36).substr(2, 9).toUpperCase()
        };

        console.log('Payment processed:', paymentDetails);

        // Optionally: Send to server for record
        // fetch(`${serverBase}/orders`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(paymentDetails) });

      }, 1200);
    }

    // Load stripe config on startup (non-blocking)
    loadStripeConfig();

    // Bootstrap AI help widget (served from local server)
    (function(){
      var serverBase = (window.location.protocol === 'file:') ? 'http://localhost:3000' : window.location.origin;
      var s = document.createElement('script');
      s.src = serverBase + '/assets/ai-widget.js';
      s.defer = true;
      document.body.appendChild(s);
    })();

  </script>
</body>
</html>